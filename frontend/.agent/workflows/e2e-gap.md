---
description: 分析未提交的更改，验证 E2E 覆盖率，并在实施前规划新测试。
---

1. **分析未提交的更改**
   - 运行 `git status` 查看修改的文件。
   - 运行 `git diff` 查看实际的代码更改。
   - 分析更改以确定意图：修复了哪些具体错误或添加了哪些功能？

2. **分析 E2E 覆盖率**
   - 在 `tests/e2e/specs/` 中搜索现有的 E2E 测试。
   - 阅读相关测试文件，检查步骤 1 中的更改是否已被覆盖。
   - 确定新更改是否缺少测试用例。

3. **起草测试计划**
   - 如果发现缺少测试用例，请在当前目录中创建一个名为 `E2E_DESIGN.md` 的文件。
   - 该文件应包含：
     - **功能/修复背景**：更改的简要摘要。
     - **缺失的覆盖范围**：未测试的场景。
     - **建议的测试用例**：对于每个新测试用例，列出详细步骤和预期的断言。

4. **与用户审查**
   - 如果不需要新测试，请通知用户覆盖范围已足够并停止。
   - 如果创建了 `E2E_DESIGN.md`，请使用 `notify_user` 请求用户审查设计文档。
   - **等待**用户确认/批准设计。

5. **执行 E2E 工作流**
   - 一旦用户批准设计：
   - 使用 `view_file` 阅读 `.agent/workflows/e2e.md`。
   - 执行 `/e2e` 工作流中定义的步骤，以实施并运行设计的测试。

---
description: Pipeline for validating quality gates before committing and pushing code to Git.
---

è¿™æ˜¯ç”¨äºåœ¨æäº¤å’Œæ¨é€ä»£ç åˆ° Git ä¹‹å‰æ‰§è¡Œè´¨é‡éªŒè¯çš„å·¥ä½œæµã€‚

## å‰ç½®æ¡ä»¶
- å·²å®Œæˆä»£ç å¼€å‘ã€æµ‹è¯•å’ŒéªŒè¯
- å·²å®‰è£…å¹¶é…ç½® Git ç¯å¢ƒ

---

## å…³é”®è§„åˆ™ (Critical Rules)

**å¦‚æœåœ¨æ‰§è¡Œæœ¬å·¥ä½œæµçš„è¿‡ç¨‹ä¸­ Skip (è·³è¿‡) æˆ– Ignore (å¿½ç•¥) äº†ä»»ä½•ç”¨ä¾‹ã€Warning æˆ– Errorï¼Œä½ å¿…é¡»æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·å¹¶è§£é‡ŠåŸå› ã€‚**
è¿™æ˜¯ä¸€æ¡ç¡¬æ€§è§„å®šï¼Œæ—¨åœ¨é˜²æ­¢é—®é¢˜è¢«é™é»˜å¤„ç†ã€‚


## é˜¶æ®µ 0ï¼šè´¨é‡é—¨ç¦ï¼ˆå¿…é¡»é€šè¿‡ï¼‰

> å¼•ç”¨ `/dev` workflow @.agent/workflows/dev.md çš„é˜¶æ®µ 0ï¼Œç¡®ä¿é¡¹ç›®å¤„äºå¥åº·çŠ¶æ€ã€‚

// turbo
1. **æ¸…ç†ç¯å¢ƒï¼ˆé˜²æ­¢è¿›ç¨‹æ®‹ç•™ï¼‰**
   ```bash
   npm run test:e2e:cleanup
   ```

// turbo
2. **è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•**
   ```bash
   npm run test:unit -- --run
   ```
   - âŒ å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œ**æŠ¥å‘Šç”¨æˆ·å¹¶è¯¢é—®**ï¼šæ˜¯å¦éœ€è¦å…ˆä¿®å¤ï¼Ÿç”¨æˆ·å¯ä»¥é€‰æ‹©æ˜¯ï¼ˆå¼€å§‹ä¿®å¤æµç¨‹ï¼‰æˆ–å¦ï¼ˆç»§ç»­ï¼Œä¸æ¨èï¼‰ã€‚

// turbo
2. **è¿è¡Œæ‰€æœ‰ E2E æµ‹è¯•**
   ```bash
   npm run test:e2e
   ```
   - âŒ å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œ**æŠ¥å‘Šç”¨æˆ·å¹¶è¯¢é—®**ï¼šæ˜¯å¦éœ€è¦å…ˆä¿®å¤ï¼Ÿ
   > [!IMPORTANT]
   > å¦‚æœåœ¨æ­¤é˜¶æ®µå‘ç° E2E æµ‹è¯•å¤±è´¥å¹¶éœ€è¦ä¿®å¤ï¼Œè¯·åŠ¡å¿…éµå¾ª `/e2e` @.agent/workflows/e2e.md ä¸­çš„[æœ€ä½³å®è·µ](./e2e.md#ğŸ¯-æœ€ä½³å®è·µå¤§å…¨)å’Œ[æ¶æ„è®¾è®¡è¯¦è§£](./e2e.md#ğŸ—ï¸-æ¶æ„è®¾è®¡è¯¦è§£)ã€‚

// turbo
3. **éªŒè¯è¦†ç›–ç‡é˜ˆå€¼**
   ```bash
   npm run test:unit -- --run --coverage
   ```
   - **è´¨é‡é—¨ç¦æ ‡å‡† (é’ˆå¯¹æ¯ä¸ªæ–‡ä»¶)**ï¼š
     - è¡Œè¦†ç›–ç‡ (Lines)ï¼š>= 90%
     - åˆ†æ”¯è¦†ç›–ç‡ (Branches)ï¼š>= 70%
     - å‡½æ•°è¦†ç›–ç‡ (Functions)ï¼š>= 80%
     - è¯­å¥è¦†ç›–ç‡ (Statements)ï¼š>= 80%
   - âŒ å¦‚æœä»»ä½•æ–‡ä»¶çš„è¦†ç›–ç‡æœªè¾¾æ ‡ï¼Œ**æŠ¥å‘Šç”¨æˆ·å¹¶è¯¢é—®**ï¼šæ˜¯å¦éœ€è¦è¡¥å……æµ‹è¯•ï¼Ÿ

// turbo
4. **éªŒè¯æ„å»ºä¸ç±»å‹æ£€æŸ¥ (Build & Type Check)**
   ```bash
   npm run build
   ```
   - âŒ å¦‚æœæ„å»ºå¤±è´¥ï¼Œ**æŠ¥å‘Šç”¨æˆ·å¹¶è¯¢é—®**ï¼šæ˜¯å¦éœ€è¦ä¿®å¤ï¼Ÿ
   - > [!NOTE]
   - > æœ¬æ­¥éª¤åŒ…å« `vue-tsc` ç±»å‹æ£€æŸ¥ã€‚å¦‚æœæµ‹è¯•æ–‡ä»¶ä¸­å­˜åœ¨ç±»å‹é”™è¯¯ï¼ˆå³ä¾¿æµ‹è¯•èƒ½é€šè¿‡ï¼‰ï¼Œæ„å»ºä¹Ÿä¼šå¤±è´¥ã€‚

// turbo
5. **éªŒè¯ä»£ç è´¨é‡ï¼ˆå¤æ‚åº¦ + Lintï¼‰**
   ```bash
   npm run lint:complexity
   ```
   - **å¤æ‚åº¦é˜ˆå€¼**ï¼š
     - åœˆå¤æ‚åº¦ï¼š<= 10
     - è®¤çŸ¥å¤æ‚åº¦ï¼š<= 15
   - **Lint æ£€æŸ¥**ï¼šæ‰€æœ‰ warning å’Œ error å¿…é¡»è§£å†³
   - âŒ å¦‚æœæœ‰å¤æ‚åº¦è¶…æ ‡ã€warning æˆ– errorï¼Œ**æŠ¥å‘Šç”¨æˆ·å¹¶è¯¢é—®**ï¼šæ˜¯å¦éœ€è¦ä¿®å¤ï¼Ÿ
   - âš ï¸ **åˆ‡è®°**ï¼šå¦‚æœä½ å†³å®šå¿½ç•¥ä»»ä½• Warning/Errorï¼Œå¿…é¡»æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·å¹¶ç»™å‡ºç†ç”±ã€‚

âœ… **åªæœ‰æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼ˆæˆ–ç”¨æˆ·é€‰æ‹©ç»§ç»­ï¼‰åæ‰èƒ½è¿›å…¥é˜¶æ®µ 1ã€‚**

### é˜¶æ®µ 0 é—®é¢˜ä¿®å¤æµç¨‹

å¦‚æœç”¨æˆ·é€‰æ‹©"ä¿®å¤"é˜¶æ®µ 0 å‘ç°çš„é—®é¢˜ï¼š

1. **æš‚åœå½“å‰æäº¤ä»»åŠ¡**ï¼šå°†å…¶æ ‡è®°ä¸ºå¾…æ¢å¤çŠ¶æ€ã€‚
2. **å¯åŠ¨æ–°çš„ `/dev` @.agent/workflows/dev.md ä»»åŠ¡**ï¼š
   - ç›®æ ‡æ˜¯ä¿®å¤é˜¶æ®µ 0 ä¸­å¤±è´¥çš„ç‰¹å®šé¡¹ç›®ï¼ˆå¦‚ä¿®å¤æµ‹è¯•ã€é™ä½å¤æ‚åº¦æˆ–è¡¥å……è¦†ç›–ç‡ï¼‰ã€‚
   - è·³è¿‡è¯¥ä¿®å¤ä»»åŠ¡çš„é˜¶æ®µ 0 æ£€æŸ¥ï¼Œç›´æ¥è¿›å…¥é˜¶æ®µ 1-4ã€‚
   - å¿…é¡»éµå¾ªå®Œæ•´çš„ TDD å¾ªç¯ã€‚
3. **ä¿®å¤å®Œæˆå**ï¼š
   - è¿”å› `/commit` @.agent/workflows/commit.md ä»»åŠ¡ã€‚
   - é‡æ–°æ‰§è¡Œé˜¶æ®µ 0 çš„å…¨éƒ¨æ£€æŸ¥ä»¥ç¡®ä¿ä¿®å¤å½»åº•ä¸”æœªå¼•å…¥æ–°é—®é¢˜ã€‚
   - åªæœ‰é‡æ–°éªŒè¯é€šè¿‡åï¼Œæ‰å…è®¸è¿›å…¥é˜¶æ®µ 1 è¿›è¡Œæäº¤ã€‚

---

## é˜¶æ®µ 1ï¼šGit çŠ¶æ€æ£€æŸ¥

// turbo
1. **æ£€æŸ¥æš‚å­˜åŒºå†…å®¹**
   - è¿è¡Œ `git status`
   - ç¡®è®¤æ˜¯å¦æœ‰æ–‡ä»¶å·²æš‚å­˜ï¼ˆStagedï¼‰
   - âŒ å¦‚æœæš‚å­˜åŒºä¸ºç©ºï¼Œæé†’ç”¨æˆ·æ‰§è¡Œ `git add`
   - åˆ—å‡ºæ‰€æœ‰æœªè·Ÿè¸ªçš„æ–‡ä»¶ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦åŒ…å«åœ¨å†…

2. **éªŒè¯å½“å‰åˆ†æ”¯**
   - è™½ç„¶å…è®¸ç›´æ¥æäº¤åˆ° `main` æˆ– `master`ï¼Œä½†ä»éœ€å‘ç”¨æˆ·å±•ç¤ºå½“å‰æ‰€åœ¨åˆ†æ”¯å

---

## é˜¶æ®µ 2ï¼šåŒæ­¥è¿œç¨‹æ›´æ”¹

// turbo
1. **æ‹‰å–è¿œç¨‹ä»£ç **
   ```bash
   git pull origin <current-branch>
   ```
   - âŒ å¦‚æœå‡ºç°å†²çªï¼Œ**åœæ­¢å¹¶æŠ¥å‘Šç”¨æˆ·**ï¼Œè¦æ±‚æ‰‹åŠ¨è§£å†³å†²çªåå†ç»§ç»­æ­¤æµç¨‹ã€‚

---

## é˜¶æ®µ 3ï¼šCommit Message è§„èŒƒ

1. **ç”Ÿæˆ Commitä¿¡æ¯**
   - éµå¾ª **Conventional Commits** è§„èŒƒã€‚
   - æ ¼å¼ï¼š`<type>(<scope>): <subject>`
   - **é‡è¦ï¼šCommit Message å¿…é¡»ä½¿ç”¨è‹±æ–‡ã€‚**
   - å¸¸ç”¨ç±»å‹ï¼š
     - `feat`: æ–°åŠŸèƒ½
     - `fix`: ä¿®å¤ Bug
     - `docs`: æ–‡æ¡£æ”¹åŠ¨
     - `style`: ä»£ç æ ¼å¼æ”¹åŠ¨
     - `refactor`: é‡æ„
     - `test`: å¢åŠ æµ‹è¯•
     - `chore`: æ„å»ºæµç¨‹ã€è¾…åŠ©å·¥å…·å˜åŠ¨
   - ç¤ºä¾‹ï¼š`feat(ocr): add support for Baidu OCR API`

---

## é˜¶æ®µ 4ï¼šæ‰§è¡Œæäº¤ä¸æ¨é€

// turbo
1. **æ‰§è¡Œæäº¤**
   ```bash
   git commit -m "<message>"
   ```

// turbo
2. **æ‰§è¡Œæ¨é€**
   ```bash
   git push origin <current-branch>
   ```

---

## é˜¶æ®µ 5ï¼šæœ€ç»ˆç¡®è®¤

// turbo
1. **ç¡®è®¤æ¨é€æˆåŠŸ**
   - è¿è¡Œ `git status` ç¡®è®¤æ²¡æœ‰å¾…æäº¤æˆ–å¾…æ¨é€çš„å†…å®¹
   - æŠ¥å‘Šä»»åŠ¡å·²æˆåŠŸåŒæ­¥åˆ°è¿œç¨‹ä»“åº“

---

## å¿«é€Ÿå‚è€ƒ

| é˜¶æ®µ       | å‘½ä»¤                                    | ç”¨é€”             |
| ---------- | --------------------------------------- | ---------------- |
| è´¨é‡æ£€æŸ¥   | `npm run test:unit -- --run`            | éªŒè¯å•å…ƒæµ‹è¯•     |
| è¦†ç›–ç‡æ£€æŸ¥ | `npm run test:unit -- --run --coverage` | éªŒè¯è¦†ç›–ç‡é—¨ç¦   |
| å¤æ‚åº¦æ£€æŸ¥ | `npm run lint:complexity`               | éªŒè¯ä»£ç è´¨é‡é—¨ç¦ |
| åŒæ­¥ä»£ç    | `git pull origin <branch>`              | é˜²æ­¢æ¨é€å†²çª     |
| æäº¤æ¨é€   | `git commit && git push`                | åŒæ­¥åˆ°è¿œç¨‹ä»“åº“   |